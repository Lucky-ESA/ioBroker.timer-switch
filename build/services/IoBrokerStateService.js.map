{
  "version": 3,
  "sources": ["../../src/services/IoBrokerStateService.ts"],
  "sourcesContent": ["import { LoggingService } from \"./LoggingService\";\nimport { StateService } from \"./StateService\";\n\nexport class IoBrokerStateService implements StateService {\n    private adapter: ioBroker.Adapter;\n    constructor(\n        adapter: ioBroker.Adapter,\n        private logger?: LoggingService,\n        private checkTime: number = 0,\n    ) {\n        if (!adapter) {\n            throw new Error(\"adapter may not be null.\");\n        }\n        this.adapter = adapter;\n        this.checkTime = Date.now();\n    }\n\n    async extendObject(id: string, value: any): Promise<any> {\n        if (!id || !value) {\n            throw new Error(\"State or Object is empty! - extendObject\");\n        }\n        await this.adapter.extendObject(id, value);\n    }\n\n    setState(id: string, value: string | number | boolean, ack = true): void {\n        this.checkId(id);\n        this.adapter.setState(id, value, ack);\n    }\n\n    async setForeignState(id: string, value: string | number | boolean): Promise<any> {\n        const diffTime = Date.now() - this.checkTime;\n        this.checkTime = Date.now();\n        this.adapter.log.debug(`DIFF: ${diffTime}`);\n        if (this.adapter.config.switch_delay > 0 && this.adapter.config.switch_delay > diffTime) {\n            this.adapter.log.debug(`Start Sleep`);\n            await this.delay(this.adapter.config.switch_delay);\n        }\n        this.checkId(id);\n        this.logger?.logDebug(`Setting state ${id} with value ${value?.toString()}`);\n        this.adapter.setForeignState(id, value, false);\n    }\n\n    async getForeignState(id: string): Promise<any> {\n        return new Promise((resolve, _) => {\n            this.checkId(id);\n            this.adapter.getForeignState(id, (err, state) => {\n                if (err || state == null) {\n                    this.adapter.log.error(`Requested state ${id} returned null/undefined!`);\n                }\n                resolve(state?.val);\n            });\n        });\n    }\n\n    async getState(id: string): Promise<any> {\n        return new Promise((resolve, _) => {\n            this.checkId(id);\n            this.adapter.getForeignState(id, (err, state) => {\n                if (err || state == null) {\n                    this.adapter.log.error(`Requested getState ${id} returned null/undefined!`);\n                }\n                resolve(state?.val);\n            });\n        });\n    }\n\n    public delay(ms: number): Promise<void> {\n        return new Promise((resolve) => this.adapter.setTimeout(resolve, ms));\n    }\n\n    private checkId(id: string): void {\n        if (id == null || id.length === 0) {\n            throw new Error(\"id may not be null or empty.\");\n        }\n    }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAGO,MAAM,qBAA6C;AAAA,EAEtD,YACI,SACQ,QACA,YAAoB,GAC9B;AAFU;AACA;AAER,QAAI,CAAC,SAAS;AACV,YAAM,IAAI,MAAM,0BAA0B;AAAA,IAC9C;AACA,SAAK,UAAU;AACf,SAAK,YAAY,KAAK,IAAI;AAAA,EAC9B;AAAA,EAXQ;AAAA,EAaR,MAAM,aAAa,IAAY,OAA0B;AACrD,QAAI,CAAC,MAAM,CAAC,OAAO;AACf,YAAM,IAAI,MAAM,0CAA0C;AAAA,IAC9D;AACA,UAAM,KAAK,QAAQ,aAAa,IAAI,KAAK;AAAA,EAC7C;AAAA,EAEA,SAAS,IAAY,OAAkC,MAAM,MAAY;AACrE,SAAK,QAAQ,EAAE;AACf,SAAK,QAAQ,SAAS,IAAI,OAAO,GAAG;AAAA,EACxC;AAAA,EAEA,MAAM,gBAAgB,IAAY,OAAgD;AA7BtF;AA8BQ,UAAM,WAAW,KAAK,IAAI,IAAI,KAAK;AACnC,SAAK,YAAY,KAAK,IAAI;AAC1B,SAAK,QAAQ,IAAI,MAAM,SAAS,QAAQ,EAAE;AAC1C,QAAI,KAAK,QAAQ,OAAO,eAAe,KAAK,KAAK,QAAQ,OAAO,eAAe,UAAU;AACrF,WAAK,QAAQ,IAAI,MAAM,aAAa;AACpC,YAAM,KAAK,MAAM,KAAK,QAAQ,OAAO,YAAY;AAAA,IACrD;AACA,SAAK,QAAQ,EAAE;AACf,eAAK,WAAL,mBAAa,SAAS,iBAAiB,EAAE,eAAe,+BAAO,UAAU;AACzE,SAAK,QAAQ,gBAAgB,IAAI,OAAO,KAAK;AAAA,EACjD;AAAA,EAEA,MAAM,gBAAgB,IAA0B;AAC5C,WAAO,IAAI,QAAQ,CAAC,SAAS,MAAM;AAC/B,WAAK,QAAQ,EAAE;AACf,WAAK,QAAQ,gBAAgB,IAAI,CAAC,KAAK,UAAU;AAC7C,YAAI,OAAO,SAAS,MAAM;AACtB,eAAK,QAAQ,IAAI,MAAM,mBAAmB,EAAE,2BAA2B;AAAA,QAC3E;AACA,gBAAQ,+BAAO,GAAG;AAAA,MACtB,CAAC;AAAA,IACL,CAAC;AAAA,EACL;AAAA,EAEA,MAAM,SAAS,IAA0B;AACrC,WAAO,IAAI,QAAQ,CAAC,SAAS,MAAM;AAC/B,WAAK,QAAQ,EAAE;AACf,WAAK,QAAQ,gBAAgB,IAAI,CAAC,KAAK,UAAU;AAC7C,YAAI,OAAO,SAAS,MAAM;AACtB,eAAK,QAAQ,IAAI,MAAM,sBAAsB,EAAE,2BAA2B;AAAA,QAC9E;AACA,gBAAQ,+BAAO,GAAG;AAAA,MACtB,CAAC;AAAA,IACL,CAAC;AAAA,EACL;AAAA,EAEO,MAAM,IAA2B;AACpC,WAAO,IAAI,QAAQ,CAAC,YAAY,KAAK,QAAQ,WAAW,SAAS,EAAE,CAAC;AAAA,EACxE;AAAA,EAEQ,QAAQ,IAAkB;AAC9B,QAAI,MAAM,QAAQ,GAAG,WAAW,GAAG;AAC/B,YAAM,IAAI,MAAM,8BAA8B;AAAA,IAClD;AAAA,EACJ;AACJ;",
  "names": []
}
