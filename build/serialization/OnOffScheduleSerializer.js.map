{
  "version": 3,
  "sources": ["../../src/serialization/OnOffScheduleSerializer.ts"],
  "sourcesContent": ["import { Action } from \"../actions/Action\";\nimport { OnOffStateAction } from \"../actions/OnOffStateAction\";\nimport { UniversalTriggerScheduler } from \"../scheduler/UniversalTriggerScheduler\";\nimport { OnOffSchedule } from \"../schedules/OnOffSchedule\";\nimport { Trigger } from \"../triggers/Trigger\";\nimport { ActionReferenceSerializer } from \"./ActionReferenceSerializer\";\nimport { Serializer } from \"./Serializer\";\nimport { UniversalSerializer } from \"./UniversalSerializer\";\n\nexport class OnOffScheduleSerializer implements Serializer<OnOffSchedule> {\n    constructor(\n        private triggerScheduler: UniversalTriggerScheduler,\n        private actionSerializer: UniversalSerializer<Action>,\n        private triggerSerializer: UniversalSerializer<Trigger>,\n    ) {}\n\n    deserialize(stringToDeserialize: string): OnOffSchedule {\n        const json = JSON.parse(stringToDeserialize);\n        if (json.type !== this.getType()) {\n            throw new Error(`Can not deserialize object of type ${json.type}`);\n        }\n        const onAction = this.actionSerializer.deserialize(JSON.stringify(json.onAction));\n        const offAction = this.actionSerializer.deserialize(JSON.stringify(json.offAction));\n\n        if (onAction instanceof OnOffStateAction && offAction instanceof OnOffStateAction) {\n            const schedule = new OnOffSchedule(onAction, offAction, this.triggerScheduler);\n            schedule.setName(json.name);\n\n            this.useActionReferenceSerializer(schedule);\n            json.triggers.forEach((t: any) => {\n                schedule.addTrigger(this.triggerSerializer.deserialize(JSON.stringify(t)));\n            });\n\n            return schedule;\n        } else {\n            throw new Error(\"Actions are not OnOffStateActions\");\n        }\n    }\n\n    serialize(schedule: OnOffSchedule): string {\n        const json: any = {\n            type: this.getType(),\n            name: schedule.getName(),\n            onAction: JSON.parse(this.actionSerializer.serialize(schedule.getOnAction())),\n            offAction: JSON.parse(this.actionSerializer.serialize(schedule.getOffAction())),\n        };\n        this.useActionReferenceSerializer(schedule);\n        json.triggers = schedule.getTriggers().map((t) => JSON.parse(this.triggerSerializer.serialize(t)));\n        return JSON.stringify(json);\n    }\n\n    getType(): string {\n        return \"OnOffSchedule\";\n    }\n\n    public getTriggerSerializer(schedule: OnOffSchedule): UniversalSerializer<Trigger> {\n        if (schedule == null) {\n            throw new Error(\"Schedule may not be null/undefined\");\n        }\n        this.useActionReferenceSerializer(schedule);\n        return this.triggerSerializer;\n    }\n\n    private useActionReferenceSerializer(schedule: OnOffSchedule): void {\n        this.actionSerializer.useSerializer(\n            new ActionReferenceSerializer(\n                OnOffStateAction.prototype.constructor.name,\n                new Map([\n                    [\"On\", schedule.getOnAction()],\n                    [\"Off\", schedule.getOffAction()],\n                ]),\n            ),\n        );\n    }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,8BAAiC;AAEjC,2BAA8B;AAE9B,uCAA0C;AAInC,MAAM,wBAA6D;AAAA,EACtE,YACY,kBACA,kBACA,mBACV;AAHU;AACA;AACA;AAAA,EACT;AAAA,EAEH,YAAY,qBAA4C;AACpD,UAAM,OAAO,KAAK,MAAM,mBAAmB;AAC3C,QAAI,KAAK,SAAS,KAAK,QAAQ,GAAG;AAC9B,YAAM,IAAI,MAAM,sCAAsC,KAAK,IAAI,EAAE;AAAA,IACrE;AACA,UAAM,WAAW,KAAK,iBAAiB,YAAY,KAAK,UAAU,KAAK,QAAQ,CAAC;AAChF,UAAM,YAAY,KAAK,iBAAiB,YAAY,KAAK,UAAU,KAAK,SAAS,CAAC;AAElF,QAAI,oBAAoB,4CAAoB,qBAAqB,0CAAkB;AAC/E,YAAM,WAAW,IAAI,mCAAc,UAAU,WAAW,KAAK,gBAAgB;AAC7E,eAAS,QAAQ,KAAK,IAAI;AAE1B,WAAK,6BAA6B,QAAQ;AAC1C,WAAK,SAAS,QAAQ,CAAC,MAAW;AAC9B,iBAAS,WAAW,KAAK,kBAAkB,YAAY,KAAK,UAAU,CAAC,CAAC,CAAC;AAAA,MAC7E,CAAC;AAED,aAAO;AAAA,IACX,OAAO;AACH,YAAM,IAAI,MAAM,mCAAmC;AAAA,IACvD;AAAA,EACJ;AAAA,EAEA,UAAU,UAAiC;AACvC,UAAM,OAAY;AAAA,MACd,MAAM,KAAK,QAAQ;AAAA,MACnB,MAAM,SAAS,QAAQ;AAAA,MACvB,UAAU,KAAK,MAAM,KAAK,iBAAiB,UAAU,SAAS,YAAY,CAAC,CAAC;AAAA,MAC5E,WAAW,KAAK,MAAM,KAAK,iBAAiB,UAAU,SAAS,aAAa,CAAC,CAAC;AAAA,IAClF;AACA,SAAK,6BAA6B,QAAQ;AAC1C,SAAK,WAAW,SAAS,YAAY,EAAE,IAAI,CAAC,MAAM,KAAK,MAAM,KAAK,kBAAkB,UAAU,CAAC,CAAC,CAAC;AACjG,WAAO,KAAK,UAAU,IAAI;AAAA,EAC9B;AAAA,EAEA,UAAkB;AACd,WAAO;AAAA,EACX;AAAA,EAEO,qBAAqB,UAAuD;AAC/E,QAAI,YAAY,MAAM;AAClB,YAAM,IAAI,MAAM,oCAAoC;AAAA,IACxD;AACA,SAAK,6BAA6B,QAAQ;AAC1C,WAAO,KAAK;AAAA,EAChB;AAAA,EAEQ,6BAA6B,UAA+B;AAChE,SAAK,iBAAiB;AAAA,MAClB,IAAI;AAAA,QACA,yCAAiB,UAAU,YAAY;AAAA,QACvC,oBAAI,IAAI;AAAA,UACJ,CAAC,MAAM,SAAS,YAAY,CAAC;AAAA,UAC7B,CAAC,OAAO,SAAS,aAAa,CAAC;AAAA,QACnC,CAAC;AAAA,MACL;AAAA,IACJ;AAAA,EACJ;AACJ;",
  "names": []
}
